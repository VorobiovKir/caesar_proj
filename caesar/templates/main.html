{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ceaser Encrypting</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
</head>
<body ng-app="myApp">
    <header class="page-header">
        <div class="container">
            <img src="{% static 'images/caesar.png' %}" class="main_logo" alt="">
            <h1 class='head_title'><a href="">Caesar's Encrypting</a></h1>
            <p class='quote'>What is done by night appears by day</p>
        </div>
        <div class="clear"></div>
    </header>
    <div class="container content">
        <form action="{% url 'home' %}" method="POST">{% csrf_token %}
            <div class="input-group input-group-lg">
                <span class="input-group-addon" id="id_legend">@</span>            
                {{ form.legend }}
            </div>
            <div class="cont_textarea row">
                {{ form.text_origin }}
                <div class="cont_middle col-md-2 col-sm-2 col-lg-2">
                    <button>Reverse</button>
                    {{ form.rot }}
                    <input type="submit" id="post_ajax">
                    
                </div>
                <div class="cont_res_text col-md-5 col-sm-5 col-lg-5" id="resultAjax" ng-controller = "HelloController">
                    {# {{ result }} #}
                    {# {{ titlem }} #}
                    {% verbatim %}
                        {{ result }}
                    {% endverbatim %}
                </div>
                <div class="clear"></div>
            </div>
        </form>
        <div ng-controller="HelloController">
            <button ng-click="postAjax($event)">ajax</button>
        </div>

    </div>

<script>
    
    var my_app = angular.module('myApp', []).config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });

    my_app.controller('HelloController', function($scope, $http) {
            $scope.myData = {};
            $scope.postAjax = function(event) {
                var user_text = angular.element(document.querySelector('#id_text_origin')).val();
                var rot = angular.element(document.querySelector('#id_rot')).val();
                var ajaxSetting = {                    
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/ajax_test/',
                    params: {
                        text: user_text,
                        rot: rot
                    },
                    cache: false,
                };

                // var url = 'http://127.0.0.1:8000/ajax_test/';
                var responsePromise = $http(ajaxSetting);

                responsePromise.success(function(data) {
                    
                    angular.element(document.querySelector('#resultAjax')).html(data.result);
                });
                responsePromise.error(function(data) {
                    alert('error_new');
                });
            };
        });


</script>


<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
</body>
</html>